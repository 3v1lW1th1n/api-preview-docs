openapi: "3.0.0"
info:
  version: 1.0.0
  title: CircleCI API v2
  license:
    name: MIT
servers:
  - url: http://circleci.com/api/v2
paths:
  /me:
    get:
      summary: Return basic user information of the owner of the requested token
      operationId: me
      responses:
        '200':
          description: A map of simple user information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Me"
  /project/{id}:
    get:
      summary: Return a project by ID
      operationId: getProjectById
      parameters:
        - name: id
          in: path
          description: ID of the project
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: A project object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
  /organization/{id}:
    get:
      summary: Return an organization by ID
      operationId: getOrganizationById
      parameters:
        - name: id
          in: path
          description: ID of the organization
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: An organization object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Organization"
components:
  schemas:
    Me:
      # minimise breaking changes from /api/v1.1/me
      # See https://github.com/circleci/circle/blob/gordon/disable-build-archive/src/circle/model/user.clj#L755-L765
      type: object
      properties:
        login:
          type: string
        created_at:
          type: string
          format: date-time
        name:
          type: string
        basic_email_prefs:
          type: string
          enum: ["all", "smart", "none"]
          # This is literally a map of vcs_url to {"on_dashboard": boolean, "emails": "default"}
        projects:
          type: object
          example: {"https://github.com/username/my_project": {"on_dashboard": true, "emails": "smart"}}
          additionalProperties:
            type: object
            properties:
              on_dashboard:
                type: boolean
              emails:
                type: string
                enum: ["all", "smart", "none", "default"]
        organization-prefs:
          type: object
          example: {"github": {"username": {"email": "username@example.com"}}}
          additionalProperties:
            type: object
            additionalProperties:
              type: object
              properties:
                email:
                  type: string
        sign_in_count:
          type: number
          format: integer
        first_vcs_authorized_client_id:
          type: string
          deprecated: true
        in_beta_program:
          type: boolean
        enrolled_betas:
          type: array
          items:
            type: string
        id:
          type: string
          format: uuid
          description: User's CircleCI ID
        privacy_optout:
          type: boolean
          description: Opt out of analytics trackers
        containers:
          type: number
          format: integer
        num_projects_followed:
          type: number
          format: integer
        days_left_in_trial:
          type: number
          format: integer
        all_emails:
          type: array
          example: ["username@example.com"]
          items:
            type: string
        selected_email:
          type: string
          example: "username@example.com"
        avatar_url:
          type: string
          example: "https://avatars.example.com/369ea08d7172bfc72207e2ae1c1b17ef"
        identities:
          type: object
          additionalProperties:
            type: object
            required:
              - authorized?
              - domain
              - external_id
              - id
              - provider_id
              - type
            properties:
              avatar_url:
                type: string
                example: "https://avatars.example.com/369ea08d7172bfc72207e2ae1c1b17ef"
              external_id:
                anyOf:
                  - type: string
                  - type: number
                example: 1234567
              id:
                anyOf:
                  - type: string
                  - type: number
                example: 1234567
              name:
                type: string
                example: "User Name"
              user?:
                type: boolean
              domain:
                type: string
                example: "github.com"
              type:
                type: string
                example: "github"
              authorized?:
                type: boolean
              provider_id:
                type: string
                format: uuid
              login:
                type: string
                example: "username"
              student:
                type: boolean
                default: false
    Organization:
      description: "NOTE: The definition of Organization is subject to change."
      type: object
      properties:
        id:
          type: string
          format: uuid
    Project:
      description: "NOTE: The definition of Project is subject to change."
      type: object
      properties:
        id:
          type: string
          format: uuid
        vcs_slug:
          type: string
          enum: ["github", "bitbucket"]
        name:
          type: string
          example: "api-preview-docs"
        organization_id:
          type: string
          format: uuid
        organization_name:
          type: string
          example: "CircleCI-Public"
